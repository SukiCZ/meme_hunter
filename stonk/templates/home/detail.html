{% extends "home/base.html" %}


{% block title %}Detail{% endblock title %}


{% block content %}
    <script type="text/javascript">
        const my_contract = `contract ExampleContract =
  record meme =
    { authorAddress : address, name : string, url : string, cost : int }

  record state =
    { memes : map(int, meme), memesLength : int }

  entrypoint init() : state =
    { memes = {}, memesLength = 0 }

  entrypoint getMemesLength() : int =
    state.memesLength

  entrypoint getMeme(index : int) : meme =
    switch(Map.lookup(index, state.memes))
      None    => abort("There was no meme with this index registered.")
      Some(x) => x

  stateful entrypoint registerMeme(nameparam : string, urlparam : string, costparam : int) =
    let meme = { authorAddress = Call.caller, name = nameparam, url = urlparam, cost = costparam}
    let index = getMemesLength() + 1
    put(state{ memes[index] = meme, memesLength = index })

  stateful entrypoint fund() : bool =
    true

  stateful entrypoint buyMeme(index : int) : () =
    let tax = 1000000000000000000
    let send = Call.value - tax
    Chain.spend(ak_fUq2NesPXcYZ1CcqBcGC3StpdnQw3iVxMA3YSeCNAwfN4myQk, tax)
    Chain.spend(ak_2MKKhjfk5nmrLB4PJU4THPFRUeDi71UMvmNePEJXXXPC6mJYmV, send)`;

        let my_aepp;
        let contract;
        let debug = false;

        async function buy_meme() {

            var result = Aepp
                .request
                .contractCall({
                    source: my_contract,
                    address: "ct_5CDbQtk68W8pPVYVMUFr8hoVUCmcAxksBvRP87YEPtfjcVXcH",
                    method: "buyMeme",
                    params: [1],
                    options: {amount: 4}
                });
            if (debug) {
                console.log(result);
            }
        }

        document.addEventListener('DOMContentLoaded', (event) => {
            Aepp.request.connect();
        });

    </script>

    <h3> {{ meme.title }} </h3>
    <img src="{{ meme.url }}" alt="{{ meme.title }}" style="width: 50%">
    <p>Author: {{ meme.author }}</p>
    <button id="buy_button" onclick="buy_meme()">Buy meme</button>
{% endblock %}